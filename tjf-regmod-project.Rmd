---
title: 'MPG Analysis: Regression Models Course Project'
author: "Travis Fell"
date: "August 14, 2015"
output: html_document
---
#Executive Summary
This analysis strives to answer the questions from data in the mtcars data set: 
1. Is an automatic or manual transmission better for MPG? Technically speaking manual is better for MPG, but when accounting for factors that more strongly correlate with MPG, the difference between manual and automatic transmissions is negligible. 
2. What is the MPG difference between automatic and manual transmissions? When accounting for weight and displacement, the MPG range of improvement for manual transmissions is as follows `r mpgdelta`. 

#I. Loading and Exploring the Data
First, we'll start by loading up the data and packages we need and doing some quick exploratory analysis. 

```{r}
library(ggplot2)
library(GGally)
library(dplyr)
data(mtcars)
head(mtcars)
summary(mtcars)
summarize(group_by(mtcars, am), mean(mpg), records = length(mpg))
s <- ggpairs(c(mtcars$am, mtcars$cyl, mtcars$hp, mtcars$wt), lower = list(continuous = "smooth"), params = c(method = "loess"))
s
```
Note that the am column indicates the transmission type of the care; 1 = manual, 0 = automatic. At first blush, the manual transmissions appear to have the edge in MPG, 24.4 to 17.1 for automatics. However, there are other variables that could also have an impact on MPG that we will examine in the following section. 

#II. Isolate Transmission as a Factor of MPG
As a baseline, we will create a single linear regression between transmission type and MPG. 
```{r}
mpgtrans <- lm(mpg ~ am, mtcars)
summary(mpgtrans)$coefficients

g <- ggplot(mtcars, aes(mtcars$am, mtcars$mpg))
g <- g + geom_point()
g <- g + geom_smooth(method = 'lm')
g <- g + ylab("MPG")
g <- g + xlab("Transmission")
g

```
When taken on its own transmission type has a slope coefficient of 7.2 from automatic to manual (that is, an increase in 7.2 mpg for manual transmission vehicles). However, there are several other factors that could impact MPG. We'll compare transmission type to all variables to begin understanding how they impact transmission type as a predictor of MPG. 

```{r}
mpgall <- lm(mpg ~., mtcars)
summary(mpgall)$coefficients
```
The first thing that sticks out when creating a model with all variables is that the slope coefficient for transmission decreases significantly to 2.52. Thus, other variables in the model have an impact on transmission type as a predictor of MPG. But which ones have the biggest impact and how can they help us understand the true impact of transmission type on MPG?

We'll examine MPG as a function of number of cylindars, displacement, real axle ratio, weight, transmission and forward gears. These factors should have a functional impact on MPG and, thus, the most relevant predictors of MPG. Once we have a feel for the factors with the strongest correlation with MPG, we'll re-run our regression with the appropriate factors. 

```{r}
p = ggpairs(mtcars, columns = c(1, 2, 3, 5, 6, 9, 10), title = "Predictors of MPG")
p
```
The pairs plot shows that transmission type has a reasonably strong positive correlation with MPG. However, the variables of cylindars, displacement and weight have very strong negative correlations with MPG. Also, since displacement is a measure of total gasoline an engine would use in a single drive cycle, we'll use that variable as a measure instead of cylindars. So will will re-run our regression model with weight and displacement. 

```{r}
mpgtranswt <- lm(mpg ~ am + wt, mtcars)
summary(mpgtrans2)$coefficients
mpgtransds <- lm(mpg ~ am + disp, mtcars)
summary(mpgtrans3)$coefficients
mpgtranswtds <- lm(mpg ~ am + wt + disp, mtcars)
summary(mpgtrans4)$coefficients

```
When using weight as a second regressor, the slope of AM changes dramatically, from 7.2 to -.02. When including displacement in the model, there is a similar reduction to .17. The fact that relationship between MPG and transmission type can be so significantly impacted by other variables should give us pause when evaluating MPG performance purely as a function of transmission type. Rather, it would probably make more sense to take weight, displacement and transmission type into account when evaluating MPG performance. 

```{r}
gwt <- ggplot(mtcars, aes(wt, mpg), colour = am)
gwt <- gwt + geom_point(aes(colour = am))
gwt <- gwt + geom_smooth(method = 'lm')
gwt <- gwt + ylab("MPG")
gwt <- gwt + xlab("Weight")
gwt <- gwt + ggtitle("MPG by Weight and Transmission Type")
gwt

gds <- ggplot(mtcars, aes(disp, mpg), colour = am)
gds <- gds + geom_point(aes(colour = am))
gds <- gds + geom_smooth(method = 'lm')
gds <- gds + ylab("MPG")
gds <- gds + xlab("Displacement")
gds <- gds + ggtitle("MPG by Displacement and Transmission Type")
gds

```
In the appendix appear regression plots of MPG by Weight and MPG by Displacement, both of which distinguish manual vs automatic transmission data points. These plots illustrate one of the conclusions of this analysis: to answer the question "Is an automatic or manual transmission better for MPG?", one should consider transmission type along with the most impactful predictors of MPG: Weight and Displacement. 

#A Quick Note on Residuals
The residuals plots for the mpgtranswt model and the mpgtransds models do not seem to indicate any patterns in the data, unusual results or any other issues that would indicate some poor aspect of model fit.  

```{r}
#basic residual testing
par(mfrow = c(2,2))
plot(mpgtranswt)
plot(mpgtransds)
plot(mpgtranswtds)

round(dfbetas(mpgtrans2)[,2],3)
round(hatvalues(mpgtrans2),3)

round(dfbetas(mpgtrans3)[,2],3)
round(hatvalues(mpgtrans3),3)

# residuals vs fitted values
fit <- lm(am ~ . -1, mtcars)
plot(predict(fit), resid(fit), pch = '.')

```
#Predicting the MPG
To illustrate the impact of transmission type on MPG, we will predict the MPG holding weight constant at 3 tones and displacement constant at 250 while changing transmission type. 

```{r}
autompg <- predict(mpgtranswtds, data.frame(am = 0,  wt = 3, disp = 250), interval = "prediction")
manualmpg <- predict(mpgtranswtds, data.frame(am = 1,  wt = 3, disp = 250), interval = "prediction")

mpgdelta <- manualmpg - autompg

confint(mpgtranswtds)
```
Using the R predict function, we find that automatic transmission MPG ranges are `r autompg'. 
By comparison, manual transmission MPG ranges are `r manualmpg`. While manual is slightly better, we can conclude from this data that there is not much change when weight and displacement are taken into account, the difference being `r mpgdelta'. 

